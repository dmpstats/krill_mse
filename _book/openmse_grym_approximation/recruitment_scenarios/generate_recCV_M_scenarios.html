<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.313">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Applying the Management Strategy Evaluation tool {openMSE} to the Antarctic Krill fishery case - 1&nbsp; Simulation of Recruitment Variability and Natural Mortality</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../openmse_grym_approximation/embed_om_grym_approx_base.html" rel="next">
<link href="../../part1.html" rel="prev">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

<script src="../../site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="../../site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<link href="../../site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="../../site_libs/pagedtable-1.1/js/pagedtable.js"></script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Simulation of Recruitment Variability and Natural Mortality</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../../">Applying the Management Strategy Evaluation tool <code>{openMSE}</code> to the Antarctic Krill fishery case</a> 
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../index.html" class="sidebar-item-text sidebar-link">Introduction</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../part1.html" class="sidebar-item-text sidebar-link">openMSE Approximation</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../openmse_grym_approximation/recruitment_scenarios/generate_recCV_M_scenarios.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Simulation of Recruitment Variability and Natural Mortality</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../openmse_grym_approximation/embed_om_grym_approx_base.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Base Operating Model</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">MSE application</span>
  </li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#set-up" id="toc-set-up" class="nav-link" data-scroll-target="#set-up">Set-up</a>
  <ul class="collapse">
  <li><a href="#load-pr-scenarios" id="toc-load-pr-scenarios" class="nav-link" data-scroll-target="#load-pr-scenarios">Load PR scenarios</a></li>
  <li><a href="#specify-shared-pr-parameters" id="toc-specify-shared-pr-parameters" class="nav-link" data-scroll-target="#specify-shared-pr-parameters">Specify shared PR parameters</a></li>
  </ul></li>
  <li><a href="#simulation" id="toc-simulation" class="nav-link" data-scroll-target="#simulation">Simulation</a>
  <ul class="collapse">
  <li><a href="#set-up-simulation-function-for-parallelization" id="toc-set-up-simulation-function-for-parallelization" class="nav-link" data-scroll-target="#set-up-simulation-function-for-parallelization">Set-up simulation function for parallelization</a></li>
  <li><a href="#add-data-with-parameters-under-each-scenario." id="toc-add-data-with-parameters-under-each-scenario." class="nav-link" data-scroll-target="#add-data-with-parameters-under-each-scenario.">Add data with parameters under each scenario.</a></li>
  <li><a href="#generate-draws-of-cv_r-and-m-under-each-scenario" id="toc-generate-draws-of-cv_r-and-m-under-each-scenario" class="nav-link" data-scroll-target="#generate-draws-of-cv_r-and-m-under-each-scenario">Generate draws of <span class="math inline">\(CV_R\)</span> and <span class="math inline">\(M\)</span> under each scenario</a></li>
  </ul></li>
  <li><a href="#check-simulated-parameters" id="toc-check-simulated-parameters" class="nav-link" data-scroll-target="#check-simulated-parameters">Check simulated parameters</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Simulation of Recruitment Variability and Natural Mortality</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<div class="cell" data-hash="generate_recCV_M_scenarios_cache/html/unnamed-chunk-1_7ece12fb95cca1c32bbcd1ab11fe3963">

</div>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>Yearly recruitment (<span class="math inline">\(R\)</span>), the number of young individuals that enter the population every year, and annual natural mortality (<span class="math inline">\(M\)</span>), expressing the fraction of the population dying each year from any non-fishing causes (e.g.&nbsp;disease, competition, predation, etc.) are key governing parameters in population dynamics models.</p>
<p>Due to challenges in obtaining reliable estimates of krill biomass (and hence numbers) at recruitment, krill recruitment modelling is usually based on estimates of the proportion of recruits in the population. This method, commonly referred to as the Proportional Recruitment (PR) model, was proposed by de <span class="citation" data-cites="delamare94">de la Mare (<a href="#ref-delamare94" role="doc-biblioref">1994</a>)</span> and later expanded by <span class="citation" data-cites="pavez_etal21">Pavez et al. (<a href="#ref-pavez_etal21" role="doc-biblioref">2021</a>)</span>.</p>
<p>This approach is part of the GRYM framework and was developed by de la mare and subsequently expanded in pavez et al to address shortcomings in the way variability was being modelled.</p>
<p>krill population modelling</p>
<p>Methods currently used for the assessment of Antarctic Krill apply</p>
<p>The aim here is to generate random draws of recruitment variability (expressed as coefficient of variance, <span class="math inline">\(CV_R\)</span>) and annual natural mortality (<span class="math inline">\(M\)</span>) parameters under different scenarios of Proportional Recruitment (PR).</p>
<p>The six PR scenarios considered here are identical to those applied in <span class="citation" data-cites="maschette_etal21">Maschette et al. (<a href="#ref-maschette_etal21" role="doc-biblioref">2021</a>)</span>, where each scenario consists of a given set of input parameters</p>
<!-- Simulated draws of $CV_R$ and $M$ are subsequently used  -->
<!-- the method currently used -->
<!-- in krill assessment to simulate annual recruitment whithin the GRYM. -->
<p>consists of the mean a standard deviation of proportional recruitment calculated from a different choice of research survey time-series,</p>
<p>For further</p>
<p>different combination of survey(s), time-series and</p>
<p>given survey time-series and/or recruitment length cut-off point</p>
<p>a subset of those applied in <span class="citation" data-cites="maschette_etal21">Maschette et al. (<a href="#ref-maschette_etal21" role="doc-biblioref">2021</a>)</span>, with each scenario consisting of proportional recruitment estimates obtained from a different time-series of survey data.</p>
<p>PR scenarios considered</p>
<p>here are a subset of those applied in <span class="citation" data-cites="maschette_etal21">Maschette et al. (<a href="#ref-maschette_etal21" role="doc-biblioref">2021</a>)</span>, with each scenario consisting of mean and standard deviation estimates of proportional recruitment calculated from a given survey data.</p>
<p><strong>Note</strong>: GRYM defines recruitment as the number of individuals recruited <em>to the fishery</em> (i.e.&nbsp;not to the whole population). Grym applications to krill assume individuals recruit to the modeled stock fishery at age 1.</p>
</section>
<section id="set-up" class="level2">
<h2 class="anchored" data-anchor-id="set-up">Set-up</h2>
<p>To generate values of <span class="math inline">\(CV_R\)</span> and <span class="math inline">\(M\)</span> from proportional recruitment estimates under each scenario, we need to:</p>
<ol type="1">
<li><p>Define the within-year natural mortality structure</p></li>
<li><p>Choose the quantile function that defines the distribution of proportional recruits</p></li>
<li><p>Provide the mean and variance estimates of the proportion of recruits seen in the surveys, and the number of surveys conducted</p></li>
<li><p>Provide approximate estimates of <span class="math inline">\(M\)</span> and <span class="math inline">\(CV_R\)</span></p></li>
<li><p>Specify the number of parameter sets to generate</p></li>
</ol>
<p>For the purpose of this analysis, we are only considering scenarios with different PR estimates, i.e.&nbsp;</p>
<p>. All the remaining GRYM parameters are fixed across scenarios. For more details on the</p>
<p>for more details on PR estimates see Table 1 in <span class="citation" data-cites="maschette_etal21">Maschette et al. (<a href="#ref-maschette_etal21" role="doc-biblioref">2021</a>)</span>]</p>
<section id="load-pr-scenarios" class="level3">
<h3 class="anchored" data-anchor-id="load-pr-scenarios">Load PR scenarios</h3>
<p>For the purpose of this analysis, we are only considering scenarios with different PR parameters. All other GRYM parameters remain fixed across scenarios <span class="citation" data-cites="maschette_etal21">(for more details on PR estimates see Table 1 in <a href="#ref-maschette_etal21" role="doc-biblioref">Maschette et al. 2021</a>)</span></p>
<div class="cell" data-hash="generate_recCV_M_scenarios_cache/html/unnamed-chunk-2_07240a65bfd21a79c3aabd971d7c5a7b">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>scens <span class="ot">&lt;-</span> <span class="fu">read_xlsx</span>(</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">path =</span> <span class="st">"maschetteetal_scenarios/Grym_parameter_combinations.xlsx"</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Scenario_id =</span> Scenarios) <span class="sc">|&gt;</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter scenarios under consideration</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    Scenario_id <span class="sc">%in%</span> </span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">c</span>(<span class="st">"Initial_values"</span>, <span class="st">"Scenario_06"</span>, <span class="st">"Scenario_12"</span>, <span class="st">"Scenario_18"</span>,</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Scenario_24"</span>, <span class="st">"Scenario_30"</span>)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Scenario_id<span class="sc">:</span><span class="st">`</span><span class="at">Recruitment group</span><span class="st">`</span>, <span class="st">`</span><span class="at">Mean proportional recruitment</span><span class="st">`</span><span class="sc">:</span><span class="st">`</span><span class="at">N. surveys</span><span class="st">`</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="generate_recCV_M_scenarios_cache/html/unnamed-chunk-3_21b10ce3b427fc89014ca1e39e191c6e">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># table with PR estimate</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>scens <span class="sc">|&gt;</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kbl</span>(<span class="at">digits =</span> <span class="dv">4</span>) <span class="sc">|&gt;</span> </span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>), <span class="at">font_size =</span> <span class="dv">15</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<table class="table table-striped" style="font-size: 15px; margin-left: auto; margin-right: auto;"><caption>Proportional Recruitment estimates under each scenario (extracted from Maschette et al. 2021)</caption>
 <thead>
  <tr>
   <th style="text-align:left;"> Scenario_id </th>
   <th style="text-align:left;"> Source </th>
   <th style="text-align:left;"> Recruitment group </th>
   <th style="text-align:right;"> Mean proportional recruitment </th>
   <th style="text-align:right;"> SD of proportional recruitment </th>
   <th style="text-align:right;"> N. surveys </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> Initial_values </td>
   <td style="text-align:left;"> WG-EMM-2021 </td>
   <td style="text-align:left;"> Initial values </td>
   <td style="text-align:right;"> 0.5570 </td>
   <td style="text-align:right;"> 0.1260 </td>
   <td style="text-align:right;"> 17 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Scenario_06 </td>
   <td style="text-align:left;"> US-AMLR-Data  (1992-2011) </td>
   <td style="text-align:left;"> Catch weighted PR by survey, strata scaled </td>
   <td style="text-align:right;"> 0.4080 </td>
   <td style="text-align:right;"> 0.3118 </td>
   <td style="text-align:right;"> 20 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Scenario_12 </td>
   <td style="text-align:left;"> US-AMLR-Data &amp; Russian Survey data combined </td>
   <td style="text-align:left;"> Catch weighted PR by survey, strata scaled </td>
   <td style="text-align:right;"> 0.4089 </td>
   <td style="text-align:right;"> 0.3040 </td>
   <td style="text-align:right;"> 21 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Scenario_18 </td>
   <td style="text-align:left;"> US-AMLR-Data  (1991-2011) </td>
   <td style="text-align:left;"> Catch weighted PR by haul @36mm </td>
   <td style="text-align:right;"> 0.2520 </td>
   <td style="text-align:right;"> 0.3380 </td>
   <td style="text-align:right;"> 21 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Scenario_24 </td>
   <td style="text-align:left;"> US-AMLR-Data  (1991-2011) </td>
   <td style="text-align:left;"> Catch weighted PR by haul @40mm </td>
   <td style="text-align:right;"> 0.3630 </td>
   <td style="text-align:right;"> 0.3700 </td>
   <td style="text-align:right;"> 21 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Scenario_30 </td>
   <td style="text-align:left;"> Russian survey 2020 </td>
   <td style="text-align:left;"> Catch weighted PR by strata, strata scaled </td>
   <td style="text-align:right;"> 0.4281 </td>
   <td style="text-align:right;"> 0.1112 </td>
   <td style="text-align:right;"> 3 </td>
  </tr>
</tbody>
</table>

</div>
</div>
<p>Tidy-up parameter data for use in simulations.</p>
<div class="cell" data-hash="generate_recCV_M_scenarios_cache/html/unnamed-chunk-4_a4d7c9c716dcd8881a552c91d8f8b780">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>scens_sim_pars <span class="ot">&lt;-</span> scens <span class="sc">|&gt;</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">mnQ =</span> <span class="st">`</span><span class="at">Mean proportional recruitment</span><span class="st">`</span>,</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">sdQ =</span> <span class="st">`</span><span class="at">SD of proportional recruitment</span><span class="st">`</span>,</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_surveys =</span> <span class="st">`</span><span class="at">N. surveys</span><span class="st">`</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Scenario_id, mnQ, sdQ, n_surveys)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="specify-shared-pr-parameters" class="level3">
<h3 class="anchored" data-anchor-id="specify-shared-pr-parameters">Specify shared PR parameters</h3>
<section id="within-year-natural-mortality-pattern" class="level4">
<h4 class="anchored" data-anchor-id="within-year-natural-mortality-pattern">Within-year natural mortality pattern</h4>
<p>Assuming the impact of natural mortality is constant throughout the year, regardless of age.</p>
<div class="cell" data-hash="generate_recCV_M_scenarios_cache/html/unnamed-chunk-5_68b22e7f6bdb2c67219c2e88d0e0f86b">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Seven age classes, daily time steps - start modelling from age 1.</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>Ages <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">7</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>nsteps <span class="ot">&lt;-</span> <span class="dv">365</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>Days <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">length =</span> nsteps<span class="sc">+</span><span class="dv">1</span>)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>h <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span>nsteps</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>ages <span class="ot">&lt;-</span> <span class="fu">outer</span>(Days, Ages, <span class="at">FUN=</span><span class="st">"+"</span>)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(ages)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         [,1]     [,2]     [,3]     [,4]     [,5]     [,6]     [,7]
[1,] 1.000000 2.000000 3.000000 4.000000 5.000000 6.000000 7.000000
[2,] 1.002740 2.002740 3.002740 4.002740 5.002740 6.002740 7.002740
[3,] 1.005479 2.005479 3.005479 4.005479 5.005479 6.005479 7.005479
[4,] 1.008219 2.008219 3.008219 4.008219 5.008219 6.008219 7.008219
[5,] 1.010959 2.010959 3.010959 4.010959 5.010959 6.010959 7.010959
[6,] 1.013699 2.013699 3.013699 4.013699 5.013699 6.013699 7.013699</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the within year pattern of natural mortality</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>ms <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">1</span>, nsteps<span class="sc">+</span><span class="dv">1</span>, <span class="fu">length</span>(Ages))</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>Ms <span class="ot">&lt;-</span> <span class="fu">ctrapz</span>(ms,h) </span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>Msf <span class="ot">&lt;-</span> <span class="fu">final</span>(Ms)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>Msf</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1 1 1 1 1 1 1</code></pre>
</div>
</div>
</section>
<section id="pr-quantile-function" class="level4">
<h4 class="anchored" data-anchor-id="pr-quantile-function">PR quantile function</h4>
<p>Assuming that proportional recruitment <span class="math inline">\(Q\)</span> is distributed as an Inverse Beta distribution, as in krill’s base-case.</p>
<div class="cell" data-hash="generate_recCV_M_scenarios_cache/html/unnamed-chunk-6_306ed3755cf808c53a99a5ae506b7027">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>qdist <span class="ot">&lt;-</span> qInverseBeta</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>recdist <span class="ot">&lt;-</span> recInverseBeta</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="no.-simulations-starting-values-and-reference-age-class" class="level4">
<h4 class="anchored" data-anchor-id="no.-simulations-starting-values-and-reference-age-class">No.&nbsp;simulations, starting values and reference age class</h4>
<p>As in the base-case of krill assessment, 2nd age-class is the reference class (i.e.&nbsp;proportional recruitment is the fraction that the second age class is of the population of age class 2 and older).</p>
<div class="cell" data-hash="generate_recCV_M_scenarios_cache/html/unnamed-chunk-7_a090b4e6e6d2531b70ad587a4f3731fb">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>nsim <span class="ot">&lt;-</span> <span class="dv">5000</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Best guess estimates of M and recruitment CV</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>M0 <span class="ot">&lt;-</span> <span class="fl">0.6</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>CV0 <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="co"># reference age-class</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>ref_age <span class="ot">&lt;-</span> <span class="dv">2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
</section>
<section id="simulation" class="level2">
<h2 class="anchored" data-anchor-id="simulation">Simulation</h2>
<p>Generate draws of <span class="math inline">\(CV_R\)</span> and <span class="math inline">\(M\)</span> under each scenario. Note: simulations take quite a while to run so some of the computations performed in this section should only be run in a local R session, i.e.&nbsp;they should not be evaluated during rendering.</p>
<section id="set-up-simulation-function-for-parallelization" class="level3">
<h3 class="anchored" data-anchor-id="set-up-simulation-function-for-parallelization">Set-up simulation function for parallelization</h3>
<p>Parallelization performed at the iteration level, i.e.&nbsp;each parallel node fits one proportional recruitment model given a sequence of random deviates. Each fitted model counts as one simulation, which returns one random draw of <code>M</code>, <code>CV_R</code>, and mean and standard deviation of proportional recruitment.</p>
<div class="cell" data-hash="generate_recCV_M_scenarios_cache/html/unnamed-chunk-8_3e0e1cece757b49e8f63426b20653398">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>gen_recs <span class="ot">&lt;-</span> <span class="cf">function</span>(nsim, mnQ, sdQ, n_surveys, M0, CV0, ref_age, qdist, Msf){</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="fu">progressor</span>(<span class="at">steps =</span> nsim)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">future_map_dfr</span>(</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span><span class="sc">:</span>nsim, </span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">function</span>(x){</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>      out <span class="ot">&lt;-</span> <span class="fu">prFit</span>(<span class="at">qdist =</span> qdist, <span class="at">Msf =</span> Msf, <span class="at">mnR =</span> mnQ, <span class="at">vrR =</span> sdQ<span class="sc">^</span><span class="dv">2</span>, <span class="at">n =</span> n_surveys,</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>                   <span class="at">M0 =</span> M0, <span class="at">CV0 =</span> CV0, <span class="at">r =</span> ref_age)</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">p</span>()</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>      out</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>    }, </span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">.options =</span> <span class="fu">furrr_options</span>(<span class="at">seed =</span> <span class="cn">TRUE</span>)</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="add-data-with-parameters-under-each-scenario." class="level3">
<h3 class="anchored" data-anchor-id="add-data-with-parameters-under-each-scenario.">Add data with parameters under each scenario.</h3>
<div class="cell" data-hash="generate_recCV_M_scenarios_cache/html/unnamed-chunk-9_e5963a1f9e7c3a58100f48ec28e43bea">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>scens_sim_pars <span class="ot">&lt;-</span> scens_sim_pars <span class="sc">|&gt;</span> </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(M0, CV0, ref_age, <span class="at">qdist =</span> <span class="fu">list</span>(qdist), <span class="at">Msf =</span> <span class="fu">list</span>(Msf))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="generate-draws-of-cv_r-and-m-under-each-scenario" class="level3">
<h3 class="anchored" data-anchor-id="generate-draws-of-cv_r-and-m-under-each-scenario">Generate draws of <span class="math inline">\(CV_R\)</span> and <span class="math inline">\(M\)</span> under each scenario</h3>
<div class="cell" data-hash="generate_recCV_M_scenarios_cache/html/unnamed-chunk-10_54ca8b99ba17d7c9ee533fb8602fffac">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plan</span>(multisession, <span class="at">workers =</span> <span class="fu">availableCores</span>()<span class="sc">-</span><span class="dv">2</span>)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">handlers</span>(<span class="st">"progress"</span>)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="fu">tic</span>()</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>cvR_M_draws_scen <span class="ot">&lt;-</span> scens_sim_pars <span class="sc">|&gt;</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">|&gt;</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pmap</span>(<span class="cf">function</span>(Scenario_id, mnQ, sdQ, n_surveys, M0, CV0, ref_age, qdist, Msf){</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    cli<span class="sc">::</span><span class="fu">cli_alert</span>(glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">"Running {Scenario_id}"</span>))</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">with_progress</span>(</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>      out <span class="ot">&lt;-</span> <span class="fu">gen_recs</span>(<span class="at">nsim =</span> nsim, <span class="at">mnQ =</span> mnQ, <span class="at">sdQ =</span> sdQ, <span class="at">n_surveys =</span> n_surveys, <span class="at">M0 =</span> M0, </span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>                      <span class="at">CV0 =</span> CV0, <span class="at">ref_age =</span> ref_age, <span class="at">qdist =</span> qdist, <span class="at">Msf =</span> Msf)</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    cli<span class="sc">::</span><span class="fu">cli_alert_success</span>(glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">"Finished {Scenario_id}"</span>))</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    out</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a><span class="fu">toc</span>()</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a><span class="fu">plan</span>(sequential)</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(cvR_M_draws_scen) <span class="ot">&lt;-</span> scens_sim_pars<span class="sc">$</span>Scenario_id</span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a><span class="fu">plan</span>(sequential)</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a><span class="co"># save draws externally</span></span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(<span class="at">x =</span> cvR_M_draws_scen, <span class="at">file =</span> <span class="st">"cvR_M_draws_scen.rds"</span>)</span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>cvR_M_draws_scen</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="check-simulated-parameters" class="level2">
<h2 class="anchored" data-anchor-id="check-simulated-parameters">Check simulated parameters</h2>
<div class="cell" data-hash="generate_recCV_M_scenarios_cache/html/unnamed-chunk-11_10dff8534739eaa988065763409bee11">

</div>
<div class="cell" data-hash="generate_recCV_M_scenarios_cache/html/unnamed-chunk-12_d0d5ee84c5c94dacc9123143350f5803">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>cvR_M_draws_scen <span class="sc">|&gt;</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(<span class="at">.id =</span> <span class="st">"scn_id"</span>) <span class="sc">|&gt;</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> M, <span class="at">y =</span> CV)) <span class="sc">+</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">16</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"CV_R"</span>) <span class="sc">+</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>scn_id, <span class="at">scales =</span> <span class="st">"free"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p></p><figcaption class="figure-caption">Simulated values of <span class="math inline">\(CV_R\)</span> and <span class="math inline">\(M\)</span> under each scenario</figcaption><p></p>
<p><img src="generate_recCV_M_scenarios_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Summary statistics of simulated <span class="math inline">\(CV_R\)</span> and <span class="math inline">\(M\)</span></p>
<div class="cell" data-hash="generate_recCV_M_scenarios_cache/html/unnamed-chunk-13_fdc49b1f23158f0da0b1fe55f0137361">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>cvR_M_draws_scen <span class="sc">|&gt;</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(<span class="at">.id =</span> <span class="st">"scn_id"</span>) <span class="sc">|&gt;</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(scn_id) <span class="sc">|&gt;</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_M =</span> <span class="fu">mean</span>(M), <span class="at">sd_M =</span> <span class="fu">sd</span>(M), <span class="at">min_M =</span> <span class="fu">min</span>(M), <span class="at">max_M =</span> <span class="fu">max</span>(M), </span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean_CV_R =</span> <span class="fu">mean</span>(CV), <span class="at">sd_CV_R =</span> <span class="fu">sd</span>(CV), <span class="at">min_CV =</span> <span class="fu">min</span>(CV), <span class="at">max_CV =</span> <span class="fu">max</span>(CV))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["scn_id"],"name":[1],"type":["chr"],"align":["left"]},{"label":["mean_M"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["sd_M"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["min_M"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["max_M"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["mean_CV_R"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["sd_CV_R"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["min_CV"],"name":[8],"type":["dbl"],"align":["right"]},{"label":["max_CV"],"name":[9],"type":["dbl"],"align":["right"]}],"data":[{"1":"Initial_values","2":"0.85504236","3":"0.08303594","4":"0.57810040","5":"1.2690961","6":"0.5277988","7":"0.1411862","8":"0.2730681","9":"3.233729"},{"1":"Scenario_06","2":"0.54293610","3":"0.13997918","4":"0.06883522","5":"1.0542593","6":"3.7747412","7":"1.8065555","8":"0.9946090","9":"9.997690"},{"1":"Scenario_12","2":"0.56078297","3":"0.13432733","4":"0.09481660","5":"1.0533194","6":"3.6095521","7":"1.7794421","8":"0.9554239","9":"9.997745"},{"1":"Scenario_18","2":"0.09704383","3":"0.07889544","4":"0.00000000","5":"0.4622236","6":"5.2748368","7":"1.9097115","8":"1.7875744","9":"9.999542"},{"1":"Scenario_24","2":"0.21500431","3":"0.13211227","4":"0.00000000","5":"0.7113519","6":"5.4515737","7":"1.8680269","8":"1.7352697","9":"9.999695"},{"1":"Scenario_30","2":"0.57058606","3":"0.18239736","4":"0.00000000","5":"1.9782328","6":"0.6636226","7":"0.6480536","8":"0.1335712","9":"9.985841"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Frequency of draws with mortality equal to zero.</p>
<div class="cell" data-hash="generate_recCV_M_scenarios_cache/html/unnamed-chunk-14_eab5cb1a71dc4ef50d21f6507d56bc25">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>cvR_M_draws_scen <span class="sc">|&gt;</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(<span class="at">.id =</span> <span class="st">"scn_id"</span>) <span class="sc">|&gt;</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(M <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">|&gt;</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(scn_id) <span class="sc">|&gt;</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["scn_id"],"name":[1],"type":["chr"],"align":["left"]},{"label":["n"],"name":[2],"type":["int"],"align":["right"]}],"data":[{"1":"Scenario_18","2":"178"},{"1":"Scenario_24","2":"44"},{"1":"Scenario_30","2":"1"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Reverse-check - i.e.&nbsp;simulate survey estimates of PR by running the population model using recruitment series generated from draws of <span class="math inline">\(M\)</span> and <span class="math inline">\(CV_R\)</span> (based on code provided in krill’s GRYM workshop).</p>
<div class="cell" data-hash="generate_recCV_M_scenarios_cache/html/unnamed-chunk-15_2ded218bddb74a34d49912cbf6183599">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>scens_sim_pars <span class="sc">|&gt;</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">split</span>(scens_sim_pars<span class="sc">$</span>Scenario_id) <span class="sc">|&gt;</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map2</span>(<span class="at">.y =</span> cvR_M_draws_scen, <span class="cf">function</span>(scn_pars, scn_draws){</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Simulate observation process for each draw of CV_R and M, i.e. generate</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># `n` random age structures for each draw of CV_R and M and estimate mean</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># and variance of the proportion of recruits that would be observed in surveys</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    pr_mn_vr <span class="ot">&lt;-</span> scn_draws <span class="sc">|&gt;</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rowwise</span>() <span class="sc">|&gt;</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarize</span>(<span class="fu">as.data.frame</span>(<span class="fu">t</span>(<span class="fu">prSim</span>(qdist, Msf, <span class="at">n =</span> scn_pars<span class="sc">$</span>n_surveys, M, CV, <span class="at">r =</span> ref_age))), <span class="at">.groups=</span><span class="st">"drop"</span>) <span class="sc">|&gt;</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.data.frame</span>() <span class="sc">|&gt;</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rename</span>(<span class="at">sim_mnQ =</span> mnR, <span class="at">sim_vrQ =</span> vrR)</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>    title <span class="ot">&lt;-</span> scn_pars<span class="sc">$</span>Scenario_id</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Compare simulated values of mean and variance of proportional recruitment</span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># with those actually obtained from surveys</span></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(pr_mn_vr, <span class="fu">aes</span>(<span class="at">x =</span> sim_mnQ, <span class="at">y =</span> sim_vrQ)) <span class="sc">+</span></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.1</span>)<span class="sc">+</span></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> mnQ, <span class="at">y =</span> sdQ<span class="sc">^</span><span class="dv">2</span>), <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">data =</span> scn_pars) <span class="sc">+</span></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">title =</span> title) <span class="sc">+</span></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme</span>(<span class="at">axis.title =</span> <span class="fu">element_blank</span>())</span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>  }) <span class="sc">|&gt;</span></span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">wrap_plots</span>() <span class="sc">|&gt;</span></span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">patchworkGrob</span>() <span class="sc">|&gt;</span></span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>  gridExtra<span class="sc">::</span><span class="fu">grid.arrange</span>(</span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">left =</span> <span class="st">"Variance of proportion of recruits (Q)"</span>, </span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">bottom =</span> <span class="st">"Mean of proportion of recruits (Q)"</span></span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p></p><figcaption class="figure-caption">Means and variances of proportion of recruits: simulated values (black) Vs original survey values (red)</figcaption><p></p>
<p><img src="generate_recCV_M_scenarios_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Generate recruitment series from a single draw of proportional recruitment parameters, with a mean of 1 and expected <span class="math inline">\(CV_R\)</span>.</p>
<div class="cell" data-hash="generate_recCV_M_scenarios_cache/html/unnamed-chunk-16_a3a6be67928923efb0e3c9e71c73c899">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>r_series <span class="ot">&lt;-</span> cvR_M_draws_scen <span class="sc">|&gt;</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(slice, <span class="dv">107</span>) <span class="sc">|&gt;</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(<span class="at">.id =</span> <span class="st">"scn_id"</span>) <span class="sc">|&gt;</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">|&gt;</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">rec_series =</span> <span class="fu">list</span>(<span class="fu">recdist</span>(<span class="at">n =</span> <span class="dv">50000</span>, <span class="at">mn =</span> mnQ, <span class="at">vr =</span> vrQ))</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(rec_series)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="generate_recCV_M_scenarios_cache/html/unnamed-chunk-17_3c0036f8a8fe0875fc2b3c7a50b5a3f2">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>r_series <span class="sc">|&gt;</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">x =</span> rec_series), <span class="at">col =</span> <span class="st">"black"</span>, <span class="at">fill =</span> <span class="st">"gray88"</span>) <span class="sc">+</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Number of recruits"</span>) <span class="sc">+</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>scn_id, <span class="at">scales =</span> <span class="st">"free"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p></p><figcaption class="figure-caption">Histogram of recruitment series generated from one draw of parameters, for each scenario</figcaption><p></p>
<p><img src="generate_recCV_M_scenarios_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Comparing drawn value of <span class="math inline">\(CV_R\)</span> with summary statistics of the generated recruitment series.</p>
<div class="cell" data-hash="generate_recCV_M_scenarios_cache/html/unnamed-chunk-18_81d3f56dd1d8b7b89b5f5f1d16dc318e">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>r_series <span class="sc">|&gt;</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">CV_R =</span> CV) <span class="sc">|&gt;</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(scn_id, CV_R) <span class="sc">|&gt;</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_R_sample =</span> <span class="fu">mean</span>(rec_series), </span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">CV_R_sample =</span> <span class="fu">sd</span>(rec_series)<span class="sc">/</span>mean_R_sample,</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["scn_id"],"name":[1],"type":["chr"],"align":["left"]},{"label":["CV_R"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["mean_R_sample"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["CV_R_sample"],"name":[4],"type":["dbl"],"align":["right"]}],"data":[{"1":"Initial_values","2":"0.5422426","3":"1.0048600","4":"0.5410056"},{"1":"Scenario_06","2":"4.1693965","3":"1.0006763","4":"3.4905685"},{"1":"Scenario_12","2":"1.9989346","3":"0.9958275","4":"2.1220038"},{"1":"Scenario_18","2":"2.6790629","3":"0.9922767","4":"2.4616935"},{"1":"Scenario_24","2":"3.0207838","3":"1.0035664","4":"2.6715598"},{"1":"Scenario_30","2":"0.2589142","3":"1.0012732","4":"0.2596627"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Substantial difference between the CV of samples and the expected CV in scenarios <code>Scenario_12</code> and <code>Scenario_24</code>…</p>
</section>
<section id="references" class="level2">
<h2 class="anchored" data-anchor-id="references">References</h2>
<!-- ::: {#refs} -->
<!-- ::: -->
<!-- ## Check recruitment series from Maschette et al (2021) -->
<!-- ```{r} -->
<!-- rec_samples_maschette <- list.files("maschetteetal_scenarios/Recruitment_vectors/", full.names = TRUE) |> -->
<!--   map(read_rds) -->
<!-- scens_sim_pars_maschette <- rec_samples_maschette |> -->
<!--   map_df(~tibble( -->
<!--     survey_mnQ = .$R.mean, survey_sdQ = .$R.sd, n_surveys = .$R.nsurveys,  -->
<!--     ref_age = .$R.class, qdist = list(.$qdist),  -->
<!--     Msf = list(rep(1, length(.$Ages))),  -->
<!--     cvR_M_draws = list(.$pars) -->
<!--   )) -->
<!-- scens_sim_pars_maschette <- right_join( -->
<!--   scens_sim_pars_maschette,  -->
<!--   select(scens_sim_pars, Scenario_id:sdQ), -->
<!--   by = c("survey_mnQ" = "mnQ", "survey_sdQ" = "sdQ") -->
<!-- ) |> -->
<!--   relocate(Scenario_id, .before = 1) -->
<!-- ``` -->
<!-- ```{r} -->
<!-- scens_sim_pars_maschette |> -->
<!--   select(Scenario_id, cvR_M_draws) |> -->
<!--   unnest(cols = cvR_M_draws) |> -->
<!--   ggplot(aes(x = M, y = CV)) + -->
<!--   geom_point(shape = 16, alpha = 0.3) + -->
<!--   labs(y = "CV_R") + -->
<!--   facet_wrap(~Scenario_id, scales = "free") -->
<!-- ``` -->
<!-- Summary statistics of simulated $CV_R$ and $M$ -->
<!-- ```{r} -->
<!-- scens_sim_pars_maschette |> -->
<!--   mutate( -->
<!--     cvR_M_draws_stats = map( -->
<!--       cvR_M_draws,  -->
<!--       ~summarise(., across(c(M, CV), .fns = list(mean = mean, sd = sd,  min = min, max = max))) -->
<!--     ) -->
<!--   ) |> -->
<!--   select(Scenario_id, cvR_M_draws_stats) |> -->
<!--   unnest(cvR_M_draws_stats) -->
<!-- ``` -->
<!-- Some of the scenarios have draws of $M$ of 0. This implies that, in the absence -->
<!-- of fishing mortality, the population status over time is solely driven by the -->
<!-- annual recruitments. -->
<!-- ```{r} -->
<!-- #| out-width: 100% -->
<!-- #| fig-cap: "Means and variances of proportion of recruits: simulated values (black) Vs original survey values (red)" -->
<!-- #| code-fold: true -->
<!-- # Reverse-check - i.e. simulate survey estimates of PR by running the population -->
<!-- # model using recruitment series generated from PR parameters (based on code -->
<!-- # provided in krill's GRYM workshop) -->
<!-- scens_sim_pars_maschette |> -->
<!--   rowwise() |> -->
<!--   pmap(function(Scenario_id, survey_mnQ, survey_sdQ, n_surveys, ref_age, qdist, Msf,cvR_M_draws){ -->
<!--     # Simulate observation process for each draw of CV_R and M, i.e. generate -->
<!--     # `n` random age structures for each draw of CV_R and M and estimate mean -->
<!--     # and variance of the proportion of recruits that would be observed in surveys -->
<!--     pr_mn_vr <- cvR_M_draws |> -->
<!--       rowwise() |> -->
<!--       mutate(sim_Q = list(prSim(qdist, Msf, n = n_surveys, M, CV, r = ref_age))) |> -->
<!--       hoist(sim_Q, sim_mnQ = 1, sim_vrQ = 2) -->
<!--     title <- Scenario_id -->
<!--     # Compare simulated values of mean and variance of proportional recruitment -->
<!--     # with those actually obtained from surveys -->
<!--     ggplot(pr_mn_vr, aes(x = sim_mnQ, y = sim_vrQ)) + -->
<!--       geom_point(alpha = 0.1)+ -->
<!--       geom_point(aes(x = survey_mnQ, y = survey_sdQ^2), col = "red") + -->
<!--       labs(title = title) + -->
<!--       theme(axis.title = element_blank()) -->
<!--   }) |> -->
<!--   wrap_plots() |> -->
<!--   patchworkGrob() |> -->
<!--   gridExtra::grid.arrange( -->
<!--     left = "Variance of proportion of recruits",  -->
<!--     bottom = "Mean of proportion of recruits" -->
<!--   ) -->
<!-- ``` -->
<!-- Generate recruitments from one draw of proportional recruitment parameters, with -->
<!-- a mean of 1 and expected $CV_R$. -->
<!-- ```{r} -->
<!-- r_series_maschette <- scens_sim_pars_maschette |> -->
<!--   select(Scenario_id, cvR_M_draws) |> -->
<!--   unnest(cvR_M_draws) |> -->
<!--   group_by(Scenario_id) |> -->
<!--   slice(107) |> -->
<!--   rowwise() |> -->
<!--   mutate( -->
<!--     rec_series = list(recdist(n = 50000, mn = mnQ, vr = vrQ)) -->
<!--   ) |> -->
<!--   unnest(rec_series) -->
<!-- ``` -->
<!-- Comparing $CV_R$ with summary statistics of the recruitment series. -->
<!-- ```{r} -->
<!-- r_series_maschette |> -->
<!--   rename(CV_R = CV) |> -->
<!--   group_by(Scenario_id, CV_R) |> -->
<!--   summarise( -->
<!--     mean_R_sample = mean(rec_series),  -->
<!--     CV_R_sample = sd(rec_series)/mean_R_sample, -->
<!--     .groups = "drop" -->
<!--     ) -->
<!-- ``` -->
<!-- Similarly to what was observed above for locally simulated values of $CV_R$, -->
<!-- there are non-negligible differences between the CV of samples and the expected -->
<!-- CV (e.g. `Scenario_12`, `Scenario_12` and `Scenario_24`). -->
<!-- ## Try lognormally distributed $Q$ -->
<!-- See if logNormal assumption also generates draws with mortality equal to zero. -->
<!-- ```{r} -->
<!-- #| eval: false -->
<!-- scens_sim_pars_qlnorm <- scens_sim_pars |> -->
<!--   mutate(qdist = list(qLogNormal)) -->
<!-- plan(multisession, workers = availableCores()-2) -->
<!-- handlers("progress") -->
<!-- with_progress( -->
<!--   cvR_M_draws_scen_qlnorm <- gen_recs( -->
<!--     dt = scens_sim_pars_qlnorm, -->
<!--     nsim = nsim -->
<!--     ) -->
<!-- ) -->
<!-- names(cvR_M_draws_scen_qlnorm) <- scens_sim_pars_qlnorm$Scenario_id -->
<!-- plan(sequential) -->
<!-- # save draws externally -->
<!-- write_rds(x = cvR_M_draws_scen_qlnorm, file = "cvR_M_draws_scen_qlnorm.rds") -->
<!-- cvR_M_draws_scen_qlnorm -->
<!-- ``` -->
<!-- ```{r} -->
<!-- cvR_M_draws_scen_qlnorm <- read_rds("cvR_M_draws_scen_qlnorm.rds") -->
<!-- ``` -->
<!-- ```{r} -->
<!-- #| out-width: 100% -->
<!-- #| fig-cap: "Simulated values of $CV_R$ and $M$ under each scenario" -->
<!-- #| code-fold: true -->
<!-- cvR_M_draws_scen_qlnorm |> -->
<!--   bind_rows(.id = "scn_id") |> -->
<!--   ggplot(aes(x = M, y = CV)) + -->
<!--   geom_point(shape = 16, alpha = 0.3) + -->
<!--   labs(y = "CV_R") + -->
<!--   facet_wrap(~scn_id, scales = "free") -->
<!-- ``` -->
<!-- Summary statistics of simulated values of $CV_R$ and $M$. -->
<!-- ```{r} -->
<!-- cvR_M_draws_scen_qlnorm |> -->
<!--   bind_rows(.id = "scn_id") |> -->
<!--   group_by(scn_id) |> -->
<!--   summarise(mean_M = mean(M), sd_M = sd(M), min_M = min(M), max_M = max(M),  -->
<!--             mean_CV_R = mean(CV), sd_CV_R = sd(CV), min_CV = min(CV), max_CV = max(CV)) -->
<!-- ``` -->
<!-- Frequency of draws with `M == 0`. -->
<!-- ```{r} -->
<!-- cvR_M_draws_scen_qlnorm |> -->
<!--   bind_rows(.id = "scn_id") |> -->
<!--   filter(M == 0) |> -->
<!--   group_by(scn_id) |> -->
<!--   count() -->
<!-- ``` -->
<!-- Generate recruitment series from a single draw of proportional recruitment -->
<!-- parameters, with a mean of 1 and expected $CV_R$. -->
<!-- ```{r} -->
<!-- r_series_qlnorm <- cvR_M_draws_scen_qlnorm |> -->
<!--   map(slice, 10) |> -->
<!--   bind_rows(.id = "scn_id") |> -->
<!--   rowwise() |> -->
<!--   mutate( -->
<!--     rec_series = list(recLogNormal(n = 50000, mn = mnQ, vr = vrQ)) -->
<!--   ) |> -->
<!--   unnest(rec_series) -->
<!-- ``` -->
<!-- ```{r} -->
<!-- #| out-width: 100% -->
<!-- #| fig-cap: "Histogram of recruitment series generated from one draw of parameters, for each scenario" -->
<!-- #| code-fold: true -->
<!-- #| warning: false -->
<!-- r_series_qlnorm |> -->
<!--   ggplot() + -->
<!--   geom_histogram(aes(x = rec_series), col = "black", fill = "gray88") + -->
<!--   labs(x = "Number of recruits") + -->
<!--   facet_wrap(~scn_id, scales = "free") -->
<!-- ```   -->
<!-- Comparing drawn value of $CV_R$ with summary statistics of the generated recruitment series. -->
<!-- ```{r} -->
<!-- r_series_qlnorm |> -->
<!--   rename(CV_R = CV) |> -->
<!--   group_by(scn_id, CV_R) |> -->
<!--   summarise( -->
<!--     mean_R_sample = mean(rec_series),  -->
<!--     CV_R_sample = sd(rec_series)/mean_R_sample, -->
<!--     .groups = "drop" -->
<!--     ) -->
<!-- ``` -->


<div id="refs" class="references csl-bib-body hanging-indent" role="doc-bibliography">
<div id="ref-delamare94" class="csl-entry" role="doc-biblioentry">
Mare, W. de la. 1994. <span>“Modelling Krill Recruitment.”</span> CCAMLR Science 1.
</div>
<div id="ref-maschette_etal21" class="csl-entry" role="doc-biblioentry">
Maschette, D, S Wotherspoon, S Kawaguchi, and Philippe Ziegler. 2021. <span>“Grym Assessment for Subarea 48.1 Euphausia Superba Populations.”</span> WG-FSA-2021/39. Hobart, Autralia: CCAMLR. <a href="https://meetings.ccamlr.org/en/wg-fsa-2021/39">https://meetings.ccamlr.org/en/wg-fsa-2021/39</a>.
</div>
<div id="ref-pavez_etal21" class="csl-entry" role="doc-biblioentry">
Pavez, Cassandra, Simon Wotherspoon, Dale Maschette, Keith Reid, and Kerrie Swadling. 2021. <span>“Recruitment Modelling for Euphausia Superba Stock Assessments Considering the Recurrence of Years with Low Recruitment.”</span> WG-SAM-2021/09. Hobart, Autralia: CCAMLR.
</div>
</div>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../part1.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">openMSE Approximation</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../openmse_grym_approximation/embed_om_grym_approx_base.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Base Operating Model</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>