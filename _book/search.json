[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Applying the Management Strategy Evaluation tool {openMSE} to the Antarctic Krill fishery case",
    "section": "",
    "text": "Introduction\n The Antarctic krill fishery in FAO Area 48 is currently managed based on precautionary catch limits set by the The Commission for the Conservation of Antarctic Marine Living Resources (CCAMLR).\n\n\n This analysis aims to show how the tool openMSE can be applied to the Krill fishery under a data-limited framework.\nThe analysis is structured in two parts:\n\nPart 1: Approximate openMSE to the current management approach\nPart 2: Apply an example MSE to Krill"
  },
  {
    "objectID": "part1.html",
    "href": "part1.html",
    "title": "openMSE Approximation",
    "section": "",
    "text": "Main goal\nAnalysis steps\n\nRecruitment section (i.e. how recruitment is modeled under each approach)\n\nout-of-the-box deviations between frameworks (or dedicated chapter?)\nexecutive summary (?)"
  },
  {
    "objectID": "openmse_grym_approximation/recruitment_scenarios/generate_recCV_M_scenarios.html#introduction",
    "href": "openmse_grym_approximation/recruitment_scenarios/generate_recCV_M_scenarios.html#introduction",
    "title": "1  Simulation of Recruitment Variability and Natural Mortality",
    "section": "Introduction",
    "text": "Introduction\nYearly recruitment (\\(R\\)), the number of young individuals that enter the population every year, and annual natural mortality (\\(M\\)), expressing the fraction of the population dying each year from any non-fishing causes (e.g. disease, competition, predation, etc.) are key governing parameters in population dynamics models.\nDue to challenges in obtaining reliable estimates of krill biomass (and hence numbers) at recruitment, krill recruitment modelling is usually based on estimates of the proportion of recruits in the population. This method, commonly referred to as the Proportional Recruitment (PR) model, was proposed by de de la Mare (1994) and later expanded by Pavez et al. (2021).\nThis approach is part of the GRYM framework and was developed by de la mare and subsequently expanded in pavez et al to address shortcomings in the way variability was being modelled.\nkrill population modelling\nMethods currently used for the assessment of Antarctic Krill apply\nThe aim here is to generate random draws of recruitment variability (expressed as coefficient of variance, \\(CV_R\\)) and annual natural mortality (\\(M\\)) parameters under different scenarios of Proportional Recruitment (PR).\nThe six PR scenarios considered here are identical to those applied in Maschette et al. (2021), where each scenario consists of a given set of input parameters\n\n\n\nconsists of the mean a standard deviation of proportional recruitment calculated from a different choice of research survey time-series,\nFor further\ndifferent combination of survey(s), time-series and\ngiven survey time-series and/or recruitment length cut-off point\na subset of those applied in Maschette et al. (2021), with each scenario consisting of proportional recruitment estimates obtained from a different time-series of survey data.\nPR scenarios considered\nhere are a subset of those applied in Maschette et al. (2021), with each scenario consisting of mean and standard deviation estimates of proportional recruitment calculated from a given survey data.\nNote: GRYM defines recruitment as the number of individuals recruited to the fishery (i.e. not to the whole population). Grym applications to krill assume individuals recruit to the modeled stock fishery at age 1."
  },
  {
    "objectID": "openmse_grym_approximation/recruitment_scenarios/generate_recCV_M_scenarios.html#set-up",
    "href": "openmse_grym_approximation/recruitment_scenarios/generate_recCV_M_scenarios.html#set-up",
    "title": "1  Simulation of Recruitment Variability and Natural Mortality",
    "section": "Set-up",
    "text": "Set-up\nTo generate values of \\(CV_R\\) and \\(M\\) from proportional recruitment estimates under each scenario, we need to:\n\nDefine the within-year natural mortality structure\nChoose the quantile function that defines the distribution of proportional recruits\nProvide the mean and variance estimates of the proportion of recruits seen in the surveys, and the number of surveys conducted\nProvide approximate estimates of \\(M\\) and \\(CV_R\\)\nSpecify the number of parameter sets to generate\n\nFor the purpose of this analysis, we are only considering scenarios with different PR estimates, i.e. \n. All the remaining GRYM parameters are fixed across scenarios. For more details on the\nfor more details on PR estimates see Table 1 in Maschette et al. (2021)]\n\nLoad PR scenarios\nFor the purpose of this analysis, we are only considering scenarios with different PR parameters. All other GRYM parameters remain fixed across scenarios (for more details on PR estimates see Table 1 in Maschette et al. 2021)\n\nscens <- read_xlsx(\n  path = \"maschetteetal_scenarios/Grym_parameter_combinations.xlsx\"\n) |>\n  rename(Scenario_id = Scenarios) |>\n  # filter scenarios under consideration\n  filter(\n    Scenario_id %in% \n      c(\"Initial_values\", \"Scenario_06\", \"Scenario_12\", \"Scenario_18\",\n        \"Scenario_24\", \"Scenario_30\")\n  ) |>\n  select(Scenario_id:`Recruitment group`, `Mean proportional recruitment`:`N. surveys`)\n\n\n# table with PR estimate\nscens |>\n  kbl(digits = 4) |> \n  kable_styling(bootstrap_options = c(\"striped\"), font_size = 15)\n\n\nProportional Recruitment estimates under each scenario (extracted from Maschette et al. 2021)\n \n  \n    Scenario_id \n    Source \n    Recruitment group \n    Mean proportional recruitment \n    SD of proportional recruitment \n    N. surveys \n  \n \n\n  \n    Initial_values \n    WG-EMM-2021 \n    Initial values \n    0.5570 \n    0.1260 \n    17 \n  \n  \n    Scenario_06 \n    US-AMLR-Data  (1992-2011) \n    Catch weighted PR by survey, strata scaled \n    0.4080 \n    0.3118 \n    20 \n  \n  \n    Scenario_12 \n    US-AMLR-Data & Russian Survey data combined \n    Catch weighted PR by survey, strata scaled \n    0.4089 \n    0.3040 \n    21 \n  \n  \n    Scenario_18 \n    US-AMLR-Data  (1991-2011) \n    Catch weighted PR by haul @36mm \n    0.2520 \n    0.3380 \n    21 \n  \n  \n    Scenario_24 \n    US-AMLR-Data  (1991-2011) \n    Catch weighted PR by haul @40mm \n    0.3630 \n    0.3700 \n    21 \n  \n  \n    Scenario_30 \n    Russian survey 2020 \n    Catch weighted PR by strata, strata scaled \n    0.4281 \n    0.1112 \n    3 \n  \n\n\n\n\n\nTidy-up parameter data for use in simulations.\n\nscens_sim_pars <- scens |>\n  rename(\n    mnQ = `Mean proportional recruitment`,\n    sdQ = `SD of proportional recruitment`,\n    n_surveys = `N. surveys`\n    ) %>%\n  select(Scenario_id, mnQ, sdQ, n_surveys)\n\n\n\nSpecify shared PR parameters\n\nWithin-year natural mortality pattern\nAssuming the impact of natural mortality is constant throughout the year, regardless of age.\n\n# Seven age classes, daily time steps - start modelling from age 1.\nAges <- 1:7\nnsteps <- 365\nDays <- seq(0, 1, length = nsteps+1)\nh <- 1/nsteps\nages <- outer(Days, Ages, FUN=\"+\")\nhead(ages)\n\n         [,1]     [,2]     [,3]     [,4]     [,5]     [,6]     [,7]\n[1,] 1.000000 2.000000 3.000000 4.000000 5.000000 6.000000 7.000000\n[2,] 1.002740 2.002740 3.002740 4.002740 5.002740 6.002740 7.002740\n[3,] 1.005479 2.005479 3.005479 4.005479 5.005479 6.005479 7.005479\n[4,] 1.008219 2.008219 3.008219 4.008219 5.008219 6.008219 7.008219\n[5,] 1.010959 2.010959 3.010959 4.010959 5.010959 6.010959 7.010959\n[6,] 1.013699 2.013699 3.013699 4.013699 5.013699 6.013699 7.013699\n\n# Define the within year pattern of natural mortality\nms <- matrix(1, nsteps+1, length(Ages))\nMs <- ctrapz(ms,h) \nMsf <- final(Ms)\nMsf\n\n[1] 1 1 1 1 1 1 1\n\n\n\n\nPR quantile function\nAssuming that proportional recruitment \\(Q\\) is distributed as an Inverse Beta distribution, as in krill’s base-case.\n\nqdist <- qInverseBeta\nrecdist <- recInverseBeta\n\n\n\nNo. simulations, starting values and reference age class\nAs in the base-case of krill assessment, 2nd age-class is the reference class (i.e. proportional recruitment is the fraction that the second age class is of the population of age class 2 and older).\n\nnsim <- 5000\n\n# Best guess estimates of M and recruitment CV\nM0 <- 0.6\nCV0 <- 1\n\n# reference age-class\nref_age <- 2"
  },
  {
    "objectID": "openmse_grym_approximation/recruitment_scenarios/generate_recCV_M_scenarios.html#simulation",
    "href": "openmse_grym_approximation/recruitment_scenarios/generate_recCV_M_scenarios.html#simulation",
    "title": "1  Simulation of Recruitment Variability and Natural Mortality",
    "section": "Simulation",
    "text": "Simulation\nGenerate draws of \\(CV_R\\) and \\(M\\) under each scenario. Note: simulations take quite a while to run so some of the computations performed in this section should only be run in a local R session, i.e. they should not be evaluated during rendering.\n\nSet-up simulation function for parallelization\nParallelization performed at the iteration level, i.e. each parallel node fits one proportional recruitment model given a sequence of random deviates. Each fitted model counts as one simulation, which returns one random draw of M, CV_R, and mean and standard deviation of proportional recruitment.\n\ngen_recs <- function(nsim, mnQ, sdQ, n_surveys, M0, CV0, ref_age, qdist, Msf){\n\n  p <- progressor(steps = nsim)\n\n  future_map_dfr(\n    1:nsim, \n    function(x){\n      out <- prFit(qdist = qdist, Msf = Msf, mnR = mnQ, vrR = sdQ^2, n = n_surveys,\n                   M0 = M0, CV0 = CV0, r = ref_age)\n      p()\n      out\n    }, \n    .options = furrr_options(seed = TRUE)\n  )\n}\n\n\n\nAdd data with parameters under each scenario.\n\nscens_sim_pars <- scens_sim_pars |> \n  mutate(M0, CV0, ref_age, qdist = list(qdist), Msf = list(Msf))\n\n\n\nGenerate draws of \\(CV_R\\) and \\(M\\) under each scenario\n\nplan(multisession, workers = availableCores()-2)\nhandlers(\"progress\")\n\ntic()\ncvR_M_draws_scen <- scens_sim_pars |>\n  rowwise() |>\n  pmap(function(Scenario_id, mnQ, sdQ, n_surveys, M0, CV0, ref_age, qdist, Msf){\n    \n    cli::cli_alert(glue::glue(\"Running {Scenario_id}\"))\n    \n    with_progress(\n      out <- gen_recs(nsim = nsim, mnQ = mnQ, sdQ = sdQ, n_surveys = n_surveys, M0 = M0, \n                      CV0 = CV0, ref_age = ref_age, qdist = qdist, Msf = Msf)\n    )\n    \n    cli::cli_alert_success(glue::glue(\"Finished {Scenario_id}\"))\n    out\n  })\ntoc()\n\nplan(sequential)\n\nnames(cvR_M_draws_scen) <- scens_sim_pars$Scenario_id\n\nplan(sequential)\n\n# save draws externally\nwrite_rds(x = cvR_M_draws_scen, file = \"cvR_M_draws_scen.rds\")\n\ncvR_M_draws_scen"
  },
  {
    "objectID": "openmse_grym_approximation/recruitment_scenarios/generate_recCV_M_scenarios.html#check-simulated-parameters",
    "href": "openmse_grym_approximation/recruitment_scenarios/generate_recCV_M_scenarios.html#check-simulated-parameters",
    "title": "1  Simulation of Recruitment Variability and Natural Mortality",
    "section": "Check simulated parameters",
    "text": "Check simulated parameters\n\n\n\n\n\nCode\ncvR_M_draws_scen |>\n  bind_rows(.id = \"scn_id\") |>\n  ggplot(aes(x = M, y = CV)) +\n  geom_point(shape = 16, alpha = 0.3) +\n  labs(y = \"CV_R\") +\n  facet_wrap(~scn_id, scales = \"free\")\n\n\n\n\nSimulated values of \\(CV_R\\) and \\(M\\) under each scenario\n\n\n\n\n\nSummary statistics of simulated \\(CV_R\\) and \\(M\\)\n\ncvR_M_draws_scen |>\n  bind_rows(.id = \"scn_id\") |>\n  group_by(scn_id) |>\n  summarise(mean_M = mean(M), sd_M = sd(M), min_M = min(M), max_M = max(M), \n            mean_CV_R = mean(CV), sd_CV_R = sd(CV), min_CV = min(CV), max_CV = max(CV))\n\n\n\n  \n\n\n\nFrequency of draws with mortality equal to zero.\n\ncvR_M_draws_scen |>\n  bind_rows(.id = \"scn_id\") |>\n  filter(M == 0) |>\n  group_by(scn_id) |>\n  count()\n\n\n\n  \n\n\n\nReverse-check - i.e. simulate survey estimates of PR by running the population model using recruitment series generated from draws of \\(M\\) and \\(CV_R\\) (based on code provided in krill’s GRYM workshop).\n\n\nCode\nscens_sim_pars |>\n  split(scens_sim_pars$Scenario_id) |>\n  map2(.y = cvR_M_draws_scen, function(scn_pars, scn_draws){\n    \n    # Simulate observation process for each draw of CV_R and M, i.e. generate\n    # `n` random age structures for each draw of CV_R and M and estimate mean\n    # and variance of the proportion of recruits that would be observed in surveys\n    pr_mn_vr <- scn_draws |>\n      rowwise() |>\n      summarize(as.data.frame(t(prSim(qdist, Msf, n = scn_pars$n_surveys, M, CV, r = ref_age))), .groups=\"drop\") |>\n      as.data.frame() |>\n      rename(sim_mnQ = mnR, sim_vrQ = vrR)\n    \n    title <- scn_pars$Scenario_id\n    \n    # Compare simulated values of mean and variance of proportional recruitment\n    # with those actually obtained from surveys\n    ggplot(pr_mn_vr, aes(x = sim_mnQ, y = sim_vrQ)) +\n      geom_point(alpha = 0.1)+\n      geom_point(aes(x = mnQ, y = sdQ^2), col = \"red\", data = scn_pars) +\n      labs(title = title) +\n      theme(axis.title = element_blank())\n    \n  }) |>\n  wrap_plots() |>\n  patchworkGrob() |>\n  gridExtra::grid.arrange(\n    left = \"Variance of proportion of recruits (Q)\", \n    bottom = \"Mean of proportion of recruits (Q)\"\n  )\n\n\n\n\nMeans and variances of proportion of recruits: simulated values (black) Vs original survey values (red)\n\n\n\n\n\nGenerate recruitment series from a single draw of proportional recruitment parameters, with a mean of 1 and expected \\(CV_R\\).\n\nr_series <- cvR_M_draws_scen |>\n  map(slice, 107) |>\n  bind_rows(.id = \"scn_id\") |>\n  rowwise() |>\n  mutate(\n    rec_series = list(recdist(n = 50000, mn = mnQ, vr = vrQ))\n  ) |>\n  unnest(rec_series)\n\n\n\nCode\nr_series |>\n  ggplot() +\n  geom_histogram(aes(x = rec_series), col = \"black\", fill = \"gray88\") +\n  labs(x = \"Number of recruits\") +\n  facet_wrap(~scn_id, scales = \"free\")\n\n\n\n\nHistogram of recruitment series generated from one draw of parameters, for each scenario\n\n\n\n\n\nComparing drawn value of \\(CV_R\\) with summary statistics of the generated recruitment series.\n\nr_series |>\n  rename(CV_R = CV) |>\n  group_by(scn_id, CV_R) |>\n  summarise(\n    mean_R_sample = mean(rec_series), \n    CV_R_sample = sd(rec_series)/mean_R_sample,\n    .groups = \"drop\"\n    )\n\n\n\n  \n\n\n\nSubstantial difference between the CV of samples and the expected CV in scenarios Scenario_12 and Scenario_24…"
  },
  {
    "objectID": "openmse_grym_approximation/embed_om_grym_approx_base.html",
    "href": "openmse_grym_approximation/embed_om_grym_approx_base.html",
    "title": "2  Base Operating Model",
    "section": "",
    "text": "Note\n\n\n\nNote that the following section was included as an embedded html, so document styling is slightly different from remaining sections."
  },
  {
    "objectID": "openmse_grym_approximation/recruitment_scenarios/generate_recCV_M_scenarios.html",
    "href": "openmse_grym_approximation/recruitment_scenarios/generate_recCV_M_scenarios.html",
    "title": "1  Simulation of Recruitment Variability and Natural Mortality",
    "section": "",
    "text": "2 Introduction\nYearly recruitment (\\(R\\)), the number of young individuals that enter the population every year, and annual natural mortality (\\(M\\)), expressing the fraction of the population dying each year from any non-fishing causes (e.g. disease, competition, predation, etc.) are key governing parameters in population dynamics models.\nDue to challenges in obtaining reliable estimates of krill biomass (and hence numbers) at recruitment, krill recruitment modelling is usually based on estimates of the proportion of recruits in the population. This method, commonly referred to as the Proportional Recruitment (PR) model, was proposed by de de la Mare (1994) and later expanded by Pavez et al. (2021).\nThis approach is part of the GRYM framework and was developed by de la mare and subsequently expanded in pavez et al to address shortcomings in the way variability was being modelled.\nkrill population modelling\nMethods currently used for the assessment of Antarctic Krill apply\nThe aim here is to generate random draws of recruitment variability (expressed as coefficient of variance, \\(CV_R\\)) and annual natural mortality (\\(M\\)) parameters under different scenarios of Proportional Recruitment (PR).\nThe six PR scenarios considered here are identical to those applied in Maschette et al. (2021), where each scenario consists of a given set of input parameters\nconsists of the mean a standard deviation of proportional recruitment calculated from a different choice of research survey time-series,\nFor further\ndifferent combination of survey(s), time-series and\ngiven survey time-series and/or recruitment length cut-off point\na subset of those applied in Maschette et al. (2021), with each scenario consisting of proportional recruitment estimates obtained from a different time-series of survey data.\nPR scenarios considered\nhere are a subset of those applied in Maschette et al. (2021), with each scenario consisting of mean and standard deviation estimates of proportional recruitment calculated from a given survey data.\nNote: GRYM defines recruitment as the number of individuals recruited to the fishery (i.e. not to the whole population). Grym applications to krill assume individuals recruit to the modeled stock fishery at age 1."
  },
  {
    "objectID": "openmse_grym_approximation/recruitment_scenarios/generate_recCV_M_scenarios.html#references",
    "href": "openmse_grym_approximation/recruitment_scenarios/generate_recCV_M_scenarios.html#references",
    "title": "1  Simulation of Recruitment Variability and Natural Mortality",
    "section": "References",
    "text": "References\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nMare, W. de la. 1994. “Modelling Krill Recruitment.” CCAMLR Science 1.\n\n\nMaschette, D, S Wotherspoon, S Kawaguchi, and Philippe Ziegler. 2021. “Grym Assessment for Subarea 48.1 Euphausia Superba Populations.” WG-FSA-2021/39. Hobart, Autralia: CCAMLR. https://meetings.ccamlr.org/en/wg-fsa-2021/39.\n\n\nPavez, Cassandra, Simon Wotherspoon, Dale Maschette, Keith Reid, and Kerrie Swadling. 2021. “Recruitment Modelling for Euphausia Superba Stock Assessments Considering the Recurrence of Years with Low Recruitment.” WG-SAM-2021/09. Hobart, Autralia: CCAMLR."
  },
  {
    "objectID": "part1_openMSE_GRYM_approx/1_RecCV_and_M/generate_RCV_and_M.html#introduction",
    "href": "part1_openMSE_GRYM_approx/1_RecCV_and_M/generate_RCV_and_M.html#introduction",
    "title": "1  Recruitment Variability and Natural Mortality",
    "section": "1.1 Introduction",
    "text": "1.1 Introduction\nYearly recruitment (\\(R\\)), the number of young individuals that enter the population every year, and annual natural mortality (\\(M\\)), expressing the fraction of the population dying each year from any non-fishing causes (e.g. disease, competition, predation, etc.) are key governing parameters in population dynamics models.\nDue to methodological challenges in obtaining reliable estimates of krill biomass (and hence numbers) at recruitment, standard krill recruitment modelling is instead based on estimates of the proportion of recruits in the population. This method, commonly referred to as the Proportional Recruitment (PR) model, was proposed by de @delamare94 and later expanded by @pavez_etal21.\n\n\n\n\n\n\n\n\n–>  –>  –>"
  },
  {
    "objectID": "part1_openMSE_GRYM_approx/1_RecCV_and_M/generate_RCV_and_M.html#set-up",
    "href": "part1_openMSE_GRYM_approx/1_RecCV_and_M/generate_RCV_and_M.html#set-up",
    "title": "1  Recruitment Variability and Natural Mortality",
    "section": "1.2 Set-up",
    "text": "1.2 Set-up\nTo generate values of \\(CV_R\\) and \\(M\\) from proportional recruitment estimates under each scenario, we need to:\n\nDefine the within-year natural mortality structure\nChoose the quantile function that defines the distribution of proportional recruits\nProvide the mean and variance estimates of the proportion of recruits seen in the surveys, and the number of surveys conducted\nProvide approximate estimates of \\(M\\) and \\(CV_R\\)\nSpecify the number of parameter sets to generate\n\nFor the purpose of this analysis, we are only considering scenarios with different PR estimates, i.e. \n. All the remaining GRYM parameters are fixed across scenarios. For more details on the\nfor more details on PR estimates see Table 1 in @maschette_etal21]\n\n1.2.1 Load PR scenarios\nFor the purpose of this analysis, we are only considering scenarios with different PR parameters. All other GRYM parameters remain fixed across scenarios [for more details on PR estimates see Table 1 in @maschette_etal21]\n\nscens <- read_xlsx(\n  path = \"../part1_shared_files/data/maschetteetal_GRYM_pars_scenarios.xlsx\"\n) |>\n  rename(Scenario_id = Scenarios) |>\n  # filter scenarios under consideration\n  filter(\n    Scenario_id %in% \n      c(\"Initial_values\", \"Scenario_06\", \"Scenario_12\", \"Scenario_18\",\n        \"Scenario_24\", \"Scenario_30\")\n  ) |>\n  select(Scenario_id:`Recruitment group`, `Mean proportional recruitment`:`N. surveys`)\n\n\n# table with PR estimate\nscens |>\n  flextable::flextable() |>\n  flextable::theme_zebra()\n\n\nProportional Recruitment estimates under each scenario (extracted from Maschette et al. 2021)Scenario_idSourceRecruitment groupMean proportional recruitmentSD of proportional recruitmentN. surveysInitial_valuesWG-EMM-2021Initial values0.55700000.126000017Scenario_06US-AMLR-Data  (1992-2011)Catch weighted PR by survey, strata scaled0.40796510.311835020Scenario_12US-AMLR-Data & Russian Survey data combinedCatch weighted PR by survey, strata scaled0.40892180.303970821Scenario_18US-AMLR-Data  (1991-2011)Catch weighted PR by haul @36mm0.25200000.338000021Scenario_24US-AMLR-Data  (1991-2011)Catch weighted PR by haul @40mm0.36300000.370000021Scenario_30Russian survey 2020Catch weighted PR by strata, strata scaled0.42805580.11120503"
  }
]